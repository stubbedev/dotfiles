#!/usr/bin/env zsh

SELECTED=$(fzf-project-picker-util "$*")

if [[ -z $SELECTED ]]; then
  exit 0
fi

SELECTED_NAME=$(basename "$SELECTED" | tr '.' '_')
TMUXCLIENTNAME="$(whoami)($SELECTED_NAME)"
TMUX_RUNNING=$(pgrep tmux)

if [[ -z $TMUX ]] && [[ -z $TMUX_RUNNING ]]; then
  tmux new-session -ds "$TMUXCLIENTNAME" -c "$SELECTED"
fi

if ! tmux has-session -t="$TMUXCLIENTNAME" 2>/dev/null; then
  tmux new-session -ds "$TMUXCLIENTNAME" -c "$SELECTED"
fi

if [[ -n $TMUX ]]; then
  tmux switch-client -t "$TMUXCLIENTNAME"
else
  tmux attach-session -t "$TMUXCLIENTNAME"
fi
