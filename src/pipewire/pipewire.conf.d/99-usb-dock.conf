# Optimized PipeWire configuration for USB docks with KVM switches
# This configuration increases buffer sizes to prevent audio popping/crackling
# when using USB audio devices connected through docking stations and KVM switches.
#
# The larger quantum values (buffer sizes) compensate for:
# - USB communication latency
# - KVM switch electrical noise and timing jitter
# - Additional latency from the dock's USB hub
#
# Quantum size reference:
# - 128 samples @ 48kHz = ~2.7ms (low latency, may cause pops with USB/KVM)
# - 1024 samples @ 48kHz = ~21ms (stable for USB docks, imperceptible for playback)
# - 2048 samples @ 48kHz = ~42ms (maximum stability, use if 1024 still has issues)

context.properties = {
    default.clock.rate = 48000
    default.clock.quantum = 2048
    default.clock.min-quantum = 1024
    default.clock.max-quantum = 4096
    default.clock.force-quantum = 2048
}

# Stable settings for PulseAudio compatibility layer
pulse.properties = {
    pulse.min.req = 2048/48000       # 42ms minimum request
    pulse.min.quantum = 2048/48000   # 42ms minimum quantum
    pulse.min.frag = 2048/48000      # 42ms minimum fragment
}

# Prevent devices from suspending/idling (fixes pops when opening pavucontrol)
stream.properties = {
    node.pause-on-idle = false       # Don't pause streams when idle
    session.suspend-timeout-seconds = 0  # Never suspend
}
