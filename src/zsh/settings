#!/usr/bin/env zsh

bindkey "^Xa" _expand_alias
bindkey -s "^[r" "src_zsh^M"
bindkey -s "^[o" "nvim^M"
bindkey -s "^[O" "nvim .^M"
zstyle ':completion:*' completer _expand _expand_alias _complete _ignored
zstyle ':completion:*' fzf-tab true
zstyle ':completion:*' complete-options true
zstyle ':completion:*' complete-aliases true
zstyle ':completion:*' regular true
zstyle ':completion:*' sort false
zstyle ':completion:*' matcher-list 'm:{a-z}={A-Za-z}'

# disable sort when completing `git checkout`
zstyle ':completion:*:git-checkout:*' sort false
# set descriptions format to enable group support
zstyle ':completion:*:descriptions' format '[%d]'
# set list-colors to enable filename colorizing
zstyle ':completion:*' list-colors ${(s.:.)LS_COLORS}
# force zsh not to show completion menu, which allows fzf-tab to capture the unambiguous prefix
zstyle ':completion:*' menu no
if is_binary eza; then
    # preview directory's content with eza when completing cd
    zstyle ':fzf-tab:complete:cd:*' fzf-preview 'eza -1 --color=always $realpath'
fi
# custom fzf flags
zstyle ':fzf-tab:*' fzf-flags --color=fg:1,fg+:2 --bind=tab:accept --height=40% --reverse --info=inline
# switch group using `<` and `>`
zstyle ':fzf-tab:*' switch-group '<' '>'
zstyle ':fzf-tab:*' fuzzy-search true

HYPHEN_INSENSITIVE=false
DISABLE_AUTO_TITLE=true
ENABLE_CORRECTION=true
VIM_MODE_NO_DEFAULT_BINDINGS=true
ARTISAN_OPEN_ON_MAKE_EDITOR=vim
HISTFILE="$HOME/.zsh_history"
HISTTIMEFORMAT="[%F %T] "
SAVEHIST=10000
HISTSIZE=10000
ZSH_FZF_HISTORY_SEARCH_BIND='^r'

setopt APPEND_HISTORY
setopt SHARE_HISTORY
setopt EXTENDED_HISTORY
setopt HIST_IGNORE_ALL_DUPS
setopt COMPLETE_ALIASES

bindkey -s "^[A" "tmux-lazy-docker^M"
bindkey -s "^[t" "tmux-new-session^M"
bindkey -s "^[g" "tmux-lazy-git^M"
bindkey -s "^[a" "tmux-system-monitor^M"
bindkey -s "^[h" "tmux-opencode^M"

if is_binary fzf; then
    bindkey -s "^[f" "fzf-tmux-project-picker^M"
    bindkey -s "^[F" "fzf-project-picker^M"
    bindkey -s "^[d" "fzf-tmux-session-picker^M"
    bindkey -s "^[D" "fzf-directory-picker^M"
    # Load fzf shell integration (but don't let it bind TAB, we use fzf-tab instead)
    # We'll load it without completion bindings
    source <(fzf --zsh | grep -v "bindkey '^I'")
fi

if is_binary starship; then
    type starship_zle-keymap-select >/dev/null || \
      {
        eval "$(starship init zsh)"
      }
fi

if is_binary pyenv; then
    eval "$(pyenv init -)"
    eval "$(pyenv virtualenv-init -)"
fi
